import "comb.fil";

extern "signed.sv" {
   comp Neg[WIDTH]<'G: 'L-('G), ?'L: 1='G+1>(
      in: ['G, 'L] WIDTH
   ) -> (
      out: ['G, 'L] WIDTH
   ) where 'L > 'G, WIDTH > 0;
}

comp SignedConst[WIDTH, VALUE, ?D=0]<'G: D+1>() -> (
   out: ['G, 'G + D + 1] WIDTH,
) where
   WIDTH > 0,
   D >= 0
{
   if VALUE >= pow2(WIDTH-1) {
      c := new Const[WIDTH, pow2(WIDTH) - VALUE]<'G, 'G+D+1>();
      negc := new Neg[WIDTH]<'G, 'G+D+1>(c.out);
      out = negc.out;
   } else {
      posc := new Const[WIDTH, VALUE]<'G, 'G+D+1>();
      out = posc.out;
   }
}